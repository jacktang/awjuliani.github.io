<!DOCTYPE html>
<script src="d3.v3.min.js" charset="utf-8"></script>
<body background="bg.gif">
<input type="text" id="wordsN" name="wordsKnown" value="100"></input>
<button class="button">Click</button>
<div></div>
<svg width="1400" height="700">
    <text class="definition" y="20" x="20" dy="0.35em" fill="white">Mouse over node to get definition</text>
</svg>
</body>
<script>
	var panel = d3.select("svg");
    var maxWords = document.getElementById('wordsN').value;
    var numWords = 1;
    var gData;
	d3.csv("embeddingsCSV.csv", function(error, data) {
			gData = data;
        });

    d3.select("button").on("click", function() {
    		numWords = -1;
    		maxWords = document.getElementById('wordsN').value;
        });
        
    setInterval(function() {
        if (numWords < maxWords){
        	numWords = numWords + 1;
        	}
        updateCircles(gData);
		}, 30);

function updateCircles(gData){
		var nodes = panel.selectAll("g").data(gData.slice(0,numWords));
		var nodeMom = nodes.enter().append("g");
		nodeMom.append("circle").attr("fill", "white")
			.attr("fill-opacity",0.0)
			.attr("stroke","grey")
			.attr("stroke-opacity",0.0)
			.attr("stroke-width",2)
           .attr("r",10).attr("cy",Math.random() * 350).attr("cx",Math.random() * 700)
           .transition().duration(1000)
           .attr("fill-opacity",0.6)
           .attr("stroke-opacity",0.6)
           .attr("cy",function(d) {return (d.Y * 30) + 350})
           .attr("cx", function(d) {return (d.X * 50) + 700})
        nodeMom.append("text").text(function(d) {return d.WORD})
           .attr("x",Math.random() * 700).attr("y",Math.random() * 350)
           .attr("fill-opacity",0.0)
           .attr("fill","white")
           .transition().duration(1000)
           .attr("fill-opacity",1.0)
           .attr("x", function(d) {return (d.X * 50) + 685})
           .attr("y", function(d) {return (d.Y * 30)+ 370}).attr("dy", ".35em");
           
    	nodes.on("mouseover", function() {
			var definition = d3.select(this).data()[0]["DEFINITION"];
			d3.select(".definition").text(definition);
			d3.select(this).select("circle").transition()
			.attr("r",20)
			.attr("fill-opacity",0.9)
			.attr("stroke-opacity",1)
			;});
        nodes.on("mouseleave", function() {
            d3.select(".definition").text("Mouse over node to get definition");
            d3.select(this).select("circle").transition()
            .attr("r",10)
            .attr("fill-opacity",0.6)
            .attr("stroke-opacity",0.5)
            ;
            });
                
        //nodes.exit().select("circle").transition().attr("r",0).remove();
		//nodes.exit().select("text").remove();
		nodes.exit().remove();
}

</script>